<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ²‰æµ¸å¼è‹±è¯­è®­ç»ƒ | Dictation & Translation</title>
    <!-- å¼•å…¥ Diff åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/diff_match_patch/20121119/diff_match_patch.js"></script>
    <!-- å¼•å…¥ XLSX åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* --- åŸºç¡€è®¾ç½® & å“åº”å¼é€‚é… --- */
        :root {
            --primary: #4f46e5; /* å­¦ä¹ è“ */
            --primary-hover: #4338ca;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --border: #e5e7eb;
            --success: #10b981;
            --error: #ef4444;
            --radius: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- å¤´éƒ¨ & å¯¼èˆª --- */
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        h1 { font-size: 1.8rem; color: var(--text-main); margin-bottom: 10px; }
        
        .nav-tabs {
            display: flex;
            justify-content: center;
            background: #e5e7eb;
            padding: 5px;
            border-radius: 50px;
            max-width: 400px;
            margin: 0 auto;
        }
        .nav-tabs button {
            flex: 1;
            padding: 10px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 45px;
            font-weight: 600;
            color: var(--text-sub);
            transition: all 0.3s ease;
        }
        .nav-tabs button.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* --- é€šç”¨å¡ç‰‡æ ·å¼ --- */
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        
        .control-panel {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            border: 1px solid var(--border);
        }

        /* --- è¡¨å•æ§ä»¶ --- */
        select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px; /* é˜²æ­¢æ‰‹æœºç«¯è‡ªåŠ¨æ”¾å¤§ */
            box-sizing: border-box;
            font-family: inherit;
            resize: vertical;
        }
        select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        /* --- æŒ‰é’®æ ·å¼ --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: 0.2s;
            font-size: 0.95rem;
        }
        .btn-primary { background: var(--primary); color: white; width: 100%; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-secondary { background: white; border: 1px solid var(--border); color: var(--text-main); }
        .btn-check { background: var(--text-main); color: white; margin-top: 10px; width: auto; padding: 8px 16px; font-size: 0.9rem;}
        
        /* æ‰‹æœºç«¯æŒ‰é’®é€‚é… */
        @media (max-width: 600px) {
            .btn-group { flex-direction: column; gap: 10px; }
            .btn { width: 100%; }
        }

        /* --- å¬å†™ & ç¿»è¯‘ç‰¹å®š --- */
        .audio-player { width: 100%; margin: 10px 0; height: 40px; }
        
        .diff-result {
            margin-top: 15px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            font-size: 0.95rem;
        }
        .diff-del { background-color: #fee2e2; text-decoration: line-through; color: #991b1b; }
        .diff-ins { background-color: #dcfce7; color: #166534; font-weight: bold; }
        
        .analysis-tag {
            display: inline-block;
            background: #fff7ed;
            color: #c2410c;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            margin-top: 8px;
            border: 1px solid #ffedd5;
        }

        /* --- PDF æ¨¡æ€æ¡† --- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0; top: 0; width: 100%; height: 100%; 
            background-color: rgba(0,0,0,0.5); 
            backdrop-filter: blur(4px);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 2% auto; 
            padding: 0;
            border-radius: 12px;
            width: 90%; 
            max-width: 1000px;
            height: 90%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .modal-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .close-modal { font-size: 28px; font-weight: bold; cursor: pointer; color: #aaa; }
        .pdf-frame { flex: 1; border: none; width: 100%; height: 100%; }

        /* åŠ¨ç”» */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ“š è‹±æ–‡ç²¾è¿›å·¥å…·ç®±</h1>
        <div class="nav-tabs">
            <button onclick="switchTab('dictation')" id="btn-dictation" class="active">ğŸ§ å¬å†™è®­ç»ƒ</button>
            <button onclick="switchTab('translation')" id="btn-translation">ğŸ” å›è¯‘è®­ç»ƒ</button>
        </div>
    </header>

    <!-- ================= å¬å†™æ¨¡å— ================= -->
    <div id="dictation" class="section active">
        <div class="control-panel">
            <label style="font-weight:bold; display:block; margin-bottom:8px;">é€‰æ‹©è¯¾ç¨‹</label>
            <select id="dictation-select" onchange="loadDictationLesson()">
                <option value="">-- è¯·é€‰æ‹©å¬å†™ææ–™ --</option>
            </select>
        </div>

        <div id="dictation-workspace" style="display:none;">
            <!-- å®Œæ•´éŸ³é¢‘æ’­æ”¾å™¨ -->
            <div class="card" style="text-align: center; background: #e0e7ff; border:none;">
                <h3 style="margin:0 0 10px 0; color: var(--primary);">Step 1: å®Œæ•´ç£¨è€³æœµ</h3>
                <audio id="full-audio" controls class="audio-player"></audio>
            </div>

            <!-- å¥å­åˆ—è¡¨ -->
            <div id="sentence-container"></div>
            
            <!-- åº•éƒ¨å¯¼å‡º -->
            <div style="margin-top: 30px; text-align: center;">
                <button class="btn btn-primary" onclick="exportDictationExcel()" style="padding: 15px 30px; font-size: 1.1rem;">
                    ğŸ“Š å®Œæˆç»ƒä¹ å¹¶å¯¼å‡ºæŠ¥å‘Š
                </button>
            </div>
        </div>
    </div>

    <!-- ================= å›è¯‘æ¨¡å— ================= -->
    <div id="translation" class="section">
        <div class="control-panel">
            <label style="font-weight:bold; display:block; margin-bottom:8px;">é€‰æ‹©è¯­æ–™</label>
            <select id="trans-select" onchange="loadTransLesson()">
                <option value="">-- è¯·é€‰æ‹©å›è¯‘ææ–™ --</option>
            </select>
            
            <div style="margin-top: 15px; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                <!-- é¡ºåºé€‰æ‹© -->
                <div style="display: flex; gap: 15px;">
                    <label style="cursor:pointer; display:flex; align-items:center;">
                        <input type="radio" name="order" value="seq" checked> é¡ºåºç»ƒä¹ 
                    </label>
                    <label style="cursor:pointer; display:flex; align-items:center;">
                        <input type="radio" name="order" value="random"> ä¹±åºç»ƒä¹ 
                    </label>
                </div>
                
                <div style="flex:1; text-align: right; min-width: 200px;">
                    <button class="btn btn-secondary" onclick="openPdfModal()">ğŸ“„ æŸ¥çœ‹åŸæ–‡ PDF</button>
                    <button class="btn btn-primary" onclick="startTransPractice()" style="width: auto; margin-left: 10px;">ğŸš€ å¼€å§‹ç»ƒä¹ </button>
                </div>
            </div>
        </div>

        <div id="trans-workspace" style="display:none;">
            <div id="trans-cards"></div>
             <div style="margin-top: 30px; text-align: center;">
                <button class="btn btn-primary" onclick="exportTransExcel()" style="padding: 15px 30px; font-size: 1.1rem;">
                    ğŸ“Š å®Œæˆç»ƒä¹ å¹¶å¯¼å‡ºæŠ¥å‘Š
                </button>
            </div>
        </div>
    </div>
</div>

<!-- PDF æ¨¡æ€æ¡† -->
<div id="pdfModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span style="font-weight:bold; font-size:1.1rem;">åŸæ–‡é¢„è§ˆ</span>
            <span class="close-modal" onclick="closePdfModal()">&times;</span>
        </div>
        <iframe id="pdf-iframe" class="pdf-frame" src=""></iframe>
        <div style="padding:10px; text-align:center; background:#f9f9f9; font-size:0.9rem; color:#666;">
            å¦‚æœæ— æ³•é¢„è§ˆï¼Œè¯· <a id="pdf-download-link" href="#" target="_blank">ç‚¹å‡»è¿™é‡Œä¸‹è½½/æ‰“å¼€ PDF</a>
        </div>
    </div>
</div>

<script>
    // --- æ•°æ®ä¸çŠ¶æ€ ---
    let appData = {};
    let currentDictation = null;
    let currentTrans = null;
    let userDictationInputs = {};
    let userTransInputs = {};

    // --- åˆå§‹åŒ– ---
    window.onload = async function() {
        try {
            // å¦‚æœä½ ä½¿ç”¨å¤–éƒ¨ data.json, è¯·å–æ¶ˆä¸‹é¢ä¸¤è¡Œæ³¨é‡Š
            // const response = await fetch('data.json');
            // appData = await response.json();

            // --- å·²åµŒå…¥æ–°çš„ Absurdism æ•°æ® ---
            appData = {
              "dictation": [
                {
                  "id": 1,
                  "title": "Absurdism: Why Life Is Meaningless According to Absurdists",
                  "fullAudio": "audio/absurdism_full.mp3",
                  "sentences": [
                    { "id": 1, "audio": "audio/absurdism_s1.mp3", "en": "The A to Z of-isms. Absurdism.", "cn": "ä» A åˆ° Z çš„ä¸»ä¹‰.è’è¯ä¸»ä¹‰." },
                    { "id": 2, "audio": "audio/absurdism_s2.mp3", "en": "Most philosophical-isms are attempts to make sense of the world.", "cn": "â¼¤å¤šæ•°å“²å­¦ä¸»ä¹‰éƒ½åœ¨è¯•å›¾ç†è§£è¿™ä¸ªä¸–ç•Œ." },
                    { "id": 3, "audio": "audio/absurdism_s3.mp3", "en": "Who are we? Why are we? What's the point? And so on.", "cn": "æˆ‘ä»¬æ˜¯è°ï¼Ÿä¸ºä»€ä¹ˆæ˜¯æˆ‘ä»¬ï¼Ÿæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿç­‰ç­‰è¯¸å¦‚æ­¤ç±»." },
                    { "id": 4, "audio": "audio/absurdism_s4.mp3", "en": "But one-ism wastes no time on this topic at all. It's called absurdism.", "cn": "ä½†æ˜¯,æœ‰â¼€ä¸ªå“²å­¦ä¸»ä¹‰åœ¨è¿™ä¸ªé—®é¢˜ä¸Šâ¼€ç‚¹æ—¶é—´ä¹Ÿä¸æµªè´¹.å®ƒå«åšè’è¯ä¸»ä¹‰." },
                    { "id": 5, "audio": "audio/absurdism_s5.mp3", "en": "In answer to the question, \"What is the meaning of life?\" Absurdism says, there isn't any. No meaning. No point. No worries.", "cn": "åœ¨å›ç­”\"â½£å‘½çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ\"è¿™ä¸ªé—®é¢˜æ—¶.è’è¯ä¸»ä¹‰ä¼šè¡¨ç¤º,ä»€ä¹ˆéƒ½æ²¡æœ‰.æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰.æ²¡æœ‰ä»€ä¹ˆé‡ç‚¹.æ²¡ä»€ä¹ˆå¥½æ‹…â¼¼çš„." },
                    { "id": 6, "audio": "audio/absurdism_s6.mp3", "en": "Life is pointless. Existence is meaningless, and look how many peas I have in this pan.", "cn": "â½£æ´»æ˜¯æ²¡æœ‰æ„ä¹‰çš„.å­˜åœ¨æ˜¯æ²¡æœ‰â½¬çš„çš„,çœ‹çœ‹åœ¨è¿™ä¸ªé”…â¾¥æˆ‘æœ‰å¤šå°‘è±Œâ¾–." },
                    { "id": 7, "audio": "audio/absurdism_s7.mp3", "en": "Absurdism was pioneered by the Danish philosopher, Soren Kierkegaard, who said that, \"As the reality of God is beyond human comprehension, it is absurd for humans to have faith in God.\"", "cn": "è’è¯ä¸»ä¹‰çš„å¼€åˆ›è€…,ä¸¹â»¨å“²å­¦å®¶ç´¢ä¼¦Â·å…‹å°”å‡¯éƒ­å°”è¯´,\"é‰´äºä¸Šå¸çš„çœŸå®æ€§å·²ç»è¶…å‡ºäº†â¼ˆç±»çš„ç†è§£,é‚£ä¹ˆäºâ¼ˆç±»â½½â¾”ä¿¡ä»°ä¸Šå¸ç®€ç›´æ˜¯è’è°¬.\"" },
                    { "id": 8, "audio": "audio/absurdism_s8.mp3", "en": "In the 20th Century, absurdists removed the concept of God entirely from the equation, choosing to make meaning and meaninglessness an entirely human issue.", "cn": "æ—©åœ¨20ä¸–çºª,è’è°¬ä¸»ä¹‰è€…å°†ä¸Šå¸çš„æ¦‚å¿µå®Œå…¨ä»ç­‰å¼ä¸­ç§»é™¤,é€‰æ‹©å°†æ„ä¹‰å’Œâ½†æ„ä¹‰å®Œå…¨å˜æˆâ¼ˆç±»çš„é—®é¢˜." },
                    { "id": 9, "audio": "audio/absurdism_s9.mp3", "en": "Albert Camus believed that, as life is meaningless, we can have one of two responses.", "cn": "é˜¿å°”â»‰Â·åŠ ç¼ªè®¤ä¸º,ç”±äºâ½£å‘½æ˜¯æ²¡æœ‰æ„ä¹‰çš„,æˆ‘ä»¬å¯ä»¥æœ‰ä»¥ä¸‹ä¸¤ç§ååº”ä¸­çš„â¼€ç§." },
                    { "id": 10, "audio": "audio/absurdism_s10.mp3", "en": "We can end it all or we can find our own meaning. It doesn't matter.", "cn": "æˆ‘ä»¬å¯ä»¥ç»“æŸè¿™â¼€åˆ‡,ä¹Ÿå¯ä»¥æ‰¾åˆ°â¾ƒâ¼°çš„æ„ä¹‰.è¿™éƒ½â½†æ‰€è°“." },
                    { "id": 11, "audio": "audio/absurdism_s11.mp3", "en": "You can, as one of his characters does, spend your life transferring peas from one pan to another. Or you can jump off a bridge. It's all the same thing.", "cn": "ä½ å¯ä»¥åƒä»–ç¬”ä¸‹çš„â¼€ä¸ªâ»†â¾Šé‚£æ ·,â¼€è¾ˆâ¼¦çš„æ—¶é—´éƒ½â½¤æ¥æŠŠè±Œâ¾–ä»â¼€ä¸ªé”…â¾¥è½¬ç§»åˆ°å¦â¼€ä¸ªé”…â¾¥.æˆ–è€…ä½ å¯ä»¥ä»â¼€åº§æ¡¥ä¸Šè·³ä¸‹å».éƒ½æ²¡ä»€ä¹ˆå·®åˆ«." },
                    { "id": 12, "audio": "audio/absurdism_s12.mp3", "en": "Life is absurd, say the absurdists.", "cn": "è’è¯ä¸»ä¹‰è€…è¯´,â½£æ´»æ˜¯è’è°¬çš„." },
                    { "id": 13, "audio": "audio/absurdism_s13.mp3", "en": "There is no God, so there is no point.", "cn": "æ²¡æœ‰ä¸Šå¸,æ‰€ä»¥æ²¡æœ‰æ„ä¹‰." },
                    { "id": 14, "audio": "audio/absurdism_s14.mp3", "en": "But they go on to say, \"that's fine.\"", "cn": "ä½†ä»–ä»¬æ¥ç€ä¼šè¯´,\"æ²¡å…³ç³»\"." },
                    { "id": 15, "audio": "audio/absurdism_s15.mp3", "en": "Absurdism is an-ism whose influence has been strong in the arts.", "cn": "è’è¯ä¸»ä¹‰æ˜¯å¯¹è‰ºæœ¯â¼€ç›´éƒ½æœ‰å¾ˆå¼ºå½±å“çš„â¼€ç§ä¸»ä¹‰." },
                    { "id": 16, "audio": "audio/absurdism_s16.mp3", "en": "The idea that nothing has meaning is a liberating one, particularly in areas like literature and drama which have traditionally been all about the search for meaning.", "cn": "\"æ²¡æœ‰ä»€ä¹ˆæ˜¯æœ‰æ„ä¹‰çš„\"è¿™â¼€è§‚ç‚¹æ˜¯â¼€ç§æ€æƒ³è§£æ”¾,å°¤å…¶æ˜¯åœ¨â½‚å­¦å’Œæˆå‰§ç­‰ä¼ ç»Ÿä¸Šéƒ½æ˜¯å…³äºå¯»æ‰¾æ„ä¹‰çš„é¢†åŸŸ." },
                    { "id": 17, "audio": "audio/absurdism_s17.mp3", "en": "Most notably, absurdism spawned the Theatre of the Absurd, probably the only theatrical movement inspired by philosophy.", "cn": "æœ€å€¼å¾—æ³¨æ„çš„æ˜¯,è’è¯ä¸»ä¹‰å‚¬â½£äº†\"è’è¯æ´¾æˆå‰§\",è¿™å¯èƒ½æ˜¯å”¯â¼€å—åˆ°å“²å­¦å¯å‘çš„æˆå‰§è¿åŠ¨." },
                    { "id": 18, "audio": "audio/absurdism_s18.mp3", "en": "The Theatre of the Absurd gave us the French writer, EugÃ¨ne Ionesco, whose play Rhinoceros was about the dangers of conformity and featured a lot of rhinoceroses.", "cn": "\"è’è¯æ´¾æˆå‰§\"è®©æˆ‘ä»¬è®¤è¯†äº†æ³•å›½ä½œå®¶æ¬§ä»Â·å°¤å†…æ–¯åº“,ä»–çš„æˆå‰§ã€ŠçŠ€â½œã€‹è®²çš„æ˜¯å¾ªè§„è¹ˆçŸ©çš„å±é™©,å…¶ç‰¹ç‚¹æ˜¯â¾¥â¾¯æœ‰å¾ˆå¤šçŠ€â½œ." },
                    { "id": 19, "audio": "audio/absurdism_s19.mp3", "en": "The Irish genius, Samuel Beckett, whose work is less rhinoceros-based, and the British writer NF Simpson, who wasn't really an absurdist at all but is very, very funny indeed, especially in his absurd masterpiece, A Resounding Tinkle.", "cn": "è¿˜è®©æˆ‘ä»¬è®¤è¯†äº†çˆ±å°”å…°å¤©æ‰å¡ç¼ªå°”Â·â»‰å…‹ç‰¹,ä»–çš„ä½œå“ç›¸â½å‰â¼€ä½æ²¡æœ‰é‚£ä¹ˆä»¥çŠ€â½œä¸ºåŸºç¡€åˆ›ä½œå†…æ ¸;ä»¥åŠè‹±å›½ä½œå®¶çº³å¤«Â·â¾Ÿæ™®æ£®,åˆ™æ ¹æœ¬å°±ä¸æ˜¯â¼€ä¸ªçœŸæ­£çš„è’è°¬ä¸»ä¹‰è€…,ä½†ç¡®å®â¾®å¸¸â¾®å¸¸æœ‰è¶£,ç‰¹åˆ«æ˜¯åœ¨ä»–çš„è’è¯æ´¾ä»£è¡¨ä½œã€Šå“äº®çš„å®å½“å£°ã€‹ä¸­æ˜¾ç°çš„æ·‹æ¼“å°½è‡´." },
                    { "id": 20, "audio": "audio/absurdism_s20.mp3", "en": "Beckett, by the way, could also be very serious, and as in Ionesco, the critic, Kenneth Tynan, famously once said, \"Once you have seen all of Ionesco's plays, you have seen one of them.\"", "cn": "é¡ºä¾¿è¯´â¼€å¥,â»‰å…‹ç‰¹ä¹Ÿå¯ä»¥å†™â¾®å¸¸ä¸¥è‚ƒçš„â½‚å­¦ä½œå“,â½½åœ¨å°¤å†…æ–¯åº“çš„ä½œå“ä¸­,è¯„è®ºå®¶è‚¯å°¼æ€Â·æ³°å—æ›¾æœ‰å¥åâ¾”ï¼šâ€œâ¼€æ—¦ä½ çœ‹è¿‡å°¤å†…æ–¯åº“æ‰€æœ‰çš„æˆå‰§,ä½ å°±ä¼šå‘ç°ä½ åªçœ‹äº†å…¶ä¸­â¼€éƒ¨.â€" },
                    { "id": 21, "audio": "audio/absurdism_s21.mp3", "en": "Which is absurd, but true. Just like absurdism.", "cn": "è¿™å¬èµ·æ¥å¾ˆè’è°¬,ä½†å´æ˜¯äº‹å®.å°±åƒè’è¯ä¸»ä¹‰â¼€æ ·." },
                    { "id": 22, "audio": "audio/absurdism_s22.mp3", "en": "Absurdism suits comedy in fact because the best comedy is essentially absurdistâ€”and perhaps this is why absurdism will never really go away.", "cn": "è’è¯ä¸»ä¹‰å®é™…ä¸Šå¾ˆé€‚åˆå–œå‰§ï¼Œå› ä¸ºæœ€å¥½çš„å–œå‰§æœ¬è´¨ä¸Šå°±æ˜¯è’è¯çš„â€”â€”æˆ–è®¸è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè’è¯ä¸»ä¹‰æ°¸è¿œä¸ä¼šçœŸæ­£æ¶ˆå¤±çš„åŸå› ã€‚" }
                  ]
                }
              ],
              "translation": [
                {
                  "id": 1,
                  "title": "Absurdism: Why Life Is Meaningless According to Absurdists",
                  "pdf": "files/absurdism_text.pdf",
                  "pairs": [
                    { "id": 1, "cn": "ä» A åˆ° Z çš„ä¸»ä¹‰.è’è¯ä¸»ä¹‰.", "en": "The A to Z of-isms. Absurdism." },
                    { "id": 2, "cn": "â¼¤å¤šæ•°å“²å­¦ä¸»ä¹‰éƒ½åœ¨è¯•å›¾ç†è§£è¿™ä¸ªä¸–ç•Œ.", "en": "Most philosophical-isms are attempts to make sense of the world." },
                    { "id": 3, "cn": "æˆ‘ä»¬æ˜¯è°ï¼Ÿä¸ºä»€ä¹ˆæ˜¯æˆ‘ä»¬ï¼Ÿæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿç­‰ç­‰è¯¸å¦‚æ­¤ç±».", "en": "Who are we? Why are we? What's the point? And so on." },
                    { "id": 4, "cn": "ä½†æ˜¯,æœ‰â¼€ä¸ªå“²å­¦ä¸»ä¹‰åœ¨è¿™ä¸ªé—®é¢˜ä¸Šâ¼€ç‚¹æ—¶é—´ä¹Ÿä¸æµªè´¹.å®ƒå«åšè’è¯ä¸»ä¹‰.", "en": "But one-ism wastes no time on this topic at all. It's called absurdism." },
                    { "id": 5, "cn": "åœ¨å›ç­”\"â½£å‘½çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ\"è¿™ä¸ªé—®é¢˜æ—¶.è’è¯ä¸»ä¹‰ä¼šè¡¨ç¤º,ä»€ä¹ˆéƒ½æ²¡æœ‰.æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰.æ²¡æœ‰ä»€ä¹ˆé‡ç‚¹.æ²¡ä»€ä¹ˆå¥½æ‹…â¼¼çš„.", "en": "In answer to the question, \"What is the meaning of life?\" Absurdism says, there isn't any. No meaning. No point. No worries." },
                    { "id": 6, "cn": "â½£æ´»æ˜¯æ²¡æœ‰æ„ä¹‰çš„.å­˜åœ¨æ˜¯æ²¡æœ‰â½¬çš„çš„,çœ‹çœ‹åœ¨è¿™ä¸ªé”…â¾¥æˆ‘æœ‰å¤šå°‘è±Œâ¾–.", "en": "Life is pointless. Existence is meaningless, and look how many peas I have in this pan." },
                    { "id": 7, "cn": "è’è¯ä¸»ä¹‰çš„å¼€åˆ›è€…,ä¸¹â»¨å“²å­¦å®¶ç´¢ä¼¦Â·å…‹å°”å‡¯éƒ­å°”è¯´,\"é‰´äºä¸Šå¸çš„çœŸå®æ€§å·²ç»è¶…å‡ºäº†â¼ˆç±»çš„ç†è§£,é‚£ä¹ˆäºâ¼ˆç±»â½½â¾”ä¿¡ä»°ä¸Šå¸ç®€ç›´æ˜¯è’è°¬.\"", "en": "Absurdism was pioneered by the Danish philosopher, Soren Kierkegaard, who said that, \"As the reality of God is beyond human comprehension, it is absurd for humans to have faith in God.\"" },
                    { "id": 8, "cn": "æ—©åœ¨20ä¸–çºª,è’è°¬ä¸»ä¹‰è€…å°†ä¸Šå¸çš„æ¦‚å¿µå®Œå…¨ä»ç­‰å¼ä¸­ç§»é™¤,é€‰æ‹©å°†æ„ä¹‰å’Œâ½†æ„ä¹‰å®Œå…¨å˜æˆâ¼ˆç±»çš„é—®é¢˜.", "en": "In the 20th Century, absurdists removed the concept of God entirely from the equation, choosing to make meaning and meaninglessness an entirely human issue." },
                    { "id": 9, "cn": "é˜¿å°”â»‰Â·åŠ ç¼ªè®¤ä¸º,ç”±äºâ½£å‘½æ˜¯æ²¡æœ‰æ„ä¹‰çš„,æˆ‘ä»¬å¯ä»¥æœ‰ä»¥ä¸‹ä¸¤ç§ååº”ä¸­çš„â¼€ç§.", "en": "Albert Camus believed that, as life is meaningless, we can have one of two responses." },
                    { "id": 10, "cn": "æˆ‘ä»¬å¯ä»¥ç»“æŸè¿™â¼€åˆ‡,ä¹Ÿå¯ä»¥æ‰¾åˆ°â¾ƒâ¼°çš„æ„ä¹‰.è¿™éƒ½â½†æ‰€è°“.", "en": "We can end it all or we can find our own meaning. It doesn't matter." },
                    { "id": 11, "cn": "ä½ å¯ä»¥åƒä»–ç¬”ä¸‹çš„â¼€ä¸ªâ»†â¾Šé‚£æ ·,â¼€è¾ˆâ¼¦çš„æ—¶é—´éƒ½â½¤æ¥æŠŠè±Œâ¾–ä»â¼€ä¸ªé”…â¾¥è½¬ç§»åˆ°å¦â¼€ä¸ªé”…â¾¥.æˆ–è€…ä½ å¯ä»¥ä»â¼€åº§æ¡¥ä¸Šè·³ä¸‹å».éƒ½æ²¡ä»€ä¹ˆå·®åˆ«.", "en": "You can, as one of his characters does, spend your life transferring peas from one pan to another. Or you can jump off a bridge. It's all the same thing." },
                    { "id": 12, "cn": "è’è¯ä¸»ä¹‰è€…è¯´,â½£æ´»æ˜¯è’è°¬çš„.", "en": "Life is absurd, say the absurdists." },
                    { "id": 13, "cn": "æ²¡æœ‰ä¸Šå¸,æ‰€ä»¥æ²¡æœ‰æ„ä¹‰.", "en": "There is no God, so there is no point." },
                    { "id": 14, "cn": "ä½†ä»–ä»¬æ¥ç€ä¼šè¯´,\"æ²¡å…³ç³»\".", "en": "But they go on to say, \"that's fine.\"" },
                    { "id": 15, "cn": "è’è¯ä¸»ä¹‰æ˜¯å¯¹è‰ºæœ¯â¼€ç›´éƒ½æœ‰å¾ˆå¼ºå½±å“çš„â¼€ç§ä¸»ä¹‰.", "en": "Absurdism is an-ism whose influence has been strong in the arts." },
                    { "id": 16, "cn": "\"æ²¡æœ‰ä»€ä¹ˆæ˜¯æœ‰æ„ä¹‰çš„\"è¿™â¼€è§‚ç‚¹æ˜¯â¼€ç§æ€æƒ³è§£æ”¾,å°¤å…¶æ˜¯åœ¨â½‚å­¦å’Œæˆå‰§ç­‰ä¼ ç»Ÿä¸Šéƒ½æ˜¯å…³äºå¯»æ‰¾æ„ä¹‰çš„é¢†åŸŸ.", "en": "The idea that nothing has meaning is a liberating one, particularly in areas like literature and drama which have traditionally been all about the search for meaning." },
                    { "id": 17, "cn": "æœ€å€¼å¾—æ³¨æ„çš„æ˜¯,è’è¯ä¸»ä¹‰å‚¬â½£äº†\"è’è¯æ´¾æˆå‰§\",è¿™å¯èƒ½æ˜¯å”¯â¼€å—åˆ°å“²å­¦å¯å‘çš„æˆå‰§è¿åŠ¨.", "en": "Most notably, absurdism spawned the Theatre of the Absurd, probably the only theatrical movement inspired by philosophy." },
                    { "id": 18, "cn": "\"è’è¯æ´¾æˆå‰§\"è®©æˆ‘ä»¬è®¤è¯†äº†æ³•å›½ä½œå®¶æ¬§ä»Â·å°¤å†…æ–¯åº“,ä»–çš„æˆå‰§ã€ŠçŠ€â½œã€‹è®²çš„æ˜¯å¾ªè§„è¹ˆçŸ©çš„å±é™©,å…¶ç‰¹ç‚¹æ˜¯â¾¥â¾¯æœ‰å¾ˆå¤šçŠ€â½œ.", "en": "The Theatre of the Absurd gave us the French writer, EugÃ¨ne Ionesco, whose play Rhinoceros was about the dangers of conformity and featured a lot of rhinoceroses." },
                    { "id": 19, "cn": "è¿˜è®©æˆ‘ä»¬è®¤è¯†äº†çˆ±å°”å…°å¤©æ‰å¡ç¼ªå°”Â·â»‰å…‹ç‰¹,ä»–çš„ä½œå“ç›¸â½å‰â¼€ä½æ²¡æœ‰é‚£ä¹ˆä»¥çŠ€â½œä¸ºåŸºç¡€åˆ›ä½œå†…æ ¸;ä»¥åŠè‹±å›½ä½œå®¶çº³å¤«Â·â¾Ÿæ™®æ£®,åˆ™æ ¹æœ¬å°±ä¸æ˜¯â¼€ä¸ªçœŸæ­£çš„è’è°¬ä¸»ä¹‰è€…,ä½†ç¡®å®â¾®å¸¸â¾®å¸¸æœ‰è¶£,ç‰¹åˆ«æ˜¯åœ¨ä»–çš„è’è¯æ´¾ä»£è¡¨ä½œã€Šå“äº®çš„å®å½“å£°ã€‹ä¸­æ˜¾ç°çš„æ·‹æ¼“å°½è‡´.", "en": "The Irish genius, Samuel Beckett, whose work is less rhinoceros-based, and the British writer NF Simpson, who wasn't really an absurdist at all but is very, very funny indeed, especially in his absurd masterpiece, A Resounding Tinkle." },
                    { "id": 20, "cn": "é¡ºä¾¿è¯´â¼€å¥,â»‰å…‹ç‰¹ä¹Ÿå¯ä»¥å†™â¾®å¸¸ä¸¥è‚ƒçš„â½‚å­¦ä½œå“,â½½åœ¨å°¤å†…æ–¯åº“çš„ä½œå“ä¸­,è¯„è®ºå®¶è‚¯å°¼æ€Â·æ³°å—æ›¾æœ‰å¥åâ¾”ï¼šâ€œâ¼€æ—¦ä½ çœ‹è¿‡å°¤å†…æ–¯åº“æ‰€æœ‰çš„æˆå‰§,ä½ å°±ä¼šå‘ç°ä½ åªçœ‹äº†å…¶ä¸­â¼€éƒ¨.â€", "en": "Beckett, by the way, could also be very serious, and as in Ionesco, the critic, Kenneth Tynan, famously once said, \"Once you have seen all of Ionesco's plays, you have seen one of them.\"" },
                    { "id": 21, "cn": "è¿™å¬èµ·æ¥å¾ˆè’è°¬,ä½†å´æ˜¯äº‹å®.å°±åƒè’è¯ä¸»ä¹‰â¼€æ ·.", "en": "Which is absurd, but true. Just like absurdism." },
                    { "id": 22, "cn": "è’è¯ä¸»ä¹‰å®é™…ä¸Šå¾ˆé€‚åˆå–œå‰§ï¼Œå› ä¸ºæœ€å¥½çš„å–œå‰§æœ¬è´¨ä¸Šå°±æ˜¯è’è¯çš„â€”â€”æˆ–è®¸è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè’è¯ä¸»ä¹‰æ°¸è¿œä¸ä¼šçœŸæ­£æ¶ˆå¤±çš„åŸå› ã€‚", "en": "Absurdism suits comedy in fact because the best comedy is essentially absurdistâ€”and perhaps this is why absurdism will never really go away." }
                  ]
                }
              ]
            };
            // ---------------------

            initMenus();
        } catch (e) {
            console.error("Data loading failed:", e);
            alert("æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼æˆ–æ–‡ä»¶è·¯å¾„ã€‚");
        }
    };

    function initMenus() {
        const dSelect = document.getElementById('dictation-select');
        appData.dictation.forEach((d, index) => dSelect.innerHTML += `<option value="${index}">${d.title}</option>`);
        const tSelect = document.getElementById('trans-select');
        appData.translation.forEach((t, index) => tSelect.innerHTML += `<option value="${index}">${t.title}</option>`);
    }

    function switchTab(tab) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
        document.querySelectorAll('.nav-tabs button').forEach(el => el.classList.remove('active'));
        document.getElementById('btn-' + tab).classList.add('active');
    }

    // --- å¬å†™é€»è¾‘ ---
    function loadDictationLesson() {
        const index = document.getElementById('dictation-select').value;
        if (index === "") {
            document.getElementById('dictation-workspace').style.display = 'none';
            return;
        }
        
        currentDictation = appData.dictation[index];
        document.getElementById('dictation-workspace').style.display = 'block';
        document.getElementById('full-audio').src = currentDictation.fullAudio;
        
        const container = document.getElementById('sentence-container');
        container.innerHTML = '';
        userDictationInputs = {};

        currentDictation.sentences.forEach((s, idx) => {
            const html = `
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <span style="font-weight:bold; color:var(--text-sub);">Sentence ${idx + 1}</span>
                    </div>
                    <audio controls src="${s.audio}" class="audio-player"></audio>
                    <textarea id="d-input-${idx}" rows="2" placeholder="å¬å½•éŸ³ï¼Œå†™ä¸‹å¥å­..."></textarea>
                    <div style="text-align:right;">
                        <button class="btn btn-check" onclick="checkDictation(${idx})">âœ… æäº¤æ£€æŸ¥</button>
                    </div>
                    <div id="d-result-${idx}" style="display:none;"></div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    function checkDictation(idx) {
        const inputEl = document.getElementById(`d-input-${idx}`);
        const input = inputEl.value.trim();
        const original = currentDictation.sentences[idx].en;
        const resultDiv = document.getElementById(`d-result-${idx}`);
        
        userDictationInputs[idx] = input; // ä¿å­˜

        if (!input) return alert("è¯·å…ˆè¾“å…¥å†…å®¹");

        const dmp = new diff_match_patch();
        const diffs = dmp.diff_main(input, original);
        dmp.diff_cleanupSemantic(diffs);
        
        let html = '';
        let hasError = false;
        diffs.forEach(part => {
            if (part[0] === 0) html += `<span>${part[1]}</span>`;
            else if (part[0] === -1) { html += `<span class="diff-del">${part[1]}</span>`; hasError = true; }
            else { html += `<span class="diff-ins">${part[1]}</span>`; hasError = true; }
        });

        let analysis = hasError ? "ğŸ’¡ æç¤ºï¼šæ³¨æ„æ‹¼å†™æˆ–è¿è¯»ç»†èŠ‚ã€‚" : "ğŸ‰ å®Œç¾æ­£ç¡®ï¼";

        resultDiv.innerHTML = `
            <div class="diff-result">
                <div style="margin-bottom:5px;"><strong>ä½ çš„å¬å†™å¯¹æ¯”ï¼š</strong></div>
                <div>${html}</div>
                <div style="margin-top:10px; color:#666; font-size:0.9em;">åŸæ–‡ï¼š${original}</div>
                <div style="color:#666; font-size:0.9em;">è¯‘æ–‡ï¼š${currentDictation.sentences[idx].cn}</div>
                <div class="analysis-tag">${analysis}</div>
            </div>
        `;
        resultDiv.style.display = 'block';
    }

    function exportDictationExcel() {
        if (!currentDictation) return;
        const data = currentDictation.sentences.map((s, idx) => ({
            "Index": idx + 1,
            "Original Text": s.en,
            "Chinese Meaning": s.cn,
            "My Input": userDictationInputs[idx] || "(æœªå¡«å†™)"
        }));
        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Dictation Result");
        XLSX.writeFile(wb, `Dictation_${currentDictation.title}.xlsx`);
    }

    // --- å›è¯‘é€»è¾‘ ---
    function loadTransLesson() {
        const index = document.getElementById('trans-select').value;
        if (index !== "") {
            currentTrans = appData.translation[index];
            document.getElementById('trans-workspace').style.display = 'none';
        } else {
            currentTrans = null;
        }
    }

    function openPdfModal() {
        if (!currentTrans || !currentTrans.pdf) return alert("è¯·å…ˆé€‰æ‹©è¯­æ–™ï¼Œæˆ–è¯¥è¯­æ–™æœªé…ç½® PDFã€‚");
        document.getElementById('pdf-iframe').src = currentTrans.pdf;
        document.getElementById('pdf-download-link').href = currentTrans.pdf;
        document.getElementById('pdfModal').style.display = 'block';
        document.body.style.overflow = 'hidden'; // ç¦æ­¢èƒŒæ™¯æ»šåŠ¨
    }

    function closePdfModal() {
        document.getElementById('pdfModal').style.display = 'none';
        document.getElementById('pdf-iframe').src = "";
        document.body.style.overflow = 'auto';
    }

    // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
    window.onclick = function(event) {
        const modal = document.getElementById('pdfModal');
        if (event.target == modal) closePdfModal();
    }

    function startTransPractice() {
        if (!currentTrans) return alert("è¯·å…ˆé€‰æ‹©è¯­æ–™");
        
        const order = document.querySelector('input[name="order"]:checked').value;
        let pairs = [...currentTrans.pairs];
        if (order === 'random') pairs.sort(() => Math.random() - 0.5);

        const container = document.getElementById('trans-cards');
        container.innerHTML = '';
        userTransInputs = {};
        document.getElementById('trans-workspace').style.display = 'block';

        pairs.forEach((p, index) => { // Added index here
            const html = `
                <div class="card">
                    <div style="font-size:1.1rem; font-weight:bold; margin-bottom:10px;">${index + 1}. ${p.cn}</div> <!-- Added index + 1 -->
                    <textarea id="t-input-${p.id}" rows="3" placeholder="è¯·è¾“å…¥è‹±æ–‡ç¿»è¯‘..."></textarea>
                    <div style="text-align:right;">
                        <button class="btn btn-check" onclick="checkTranslation(${p.id}, '${p.en.replace(/'/g, "\\'")}')">âœ… æäº¤æ£€æŸ¥</button>
                    </div>
                    <div id="t-result-${p.id}" style="display:none;"></div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    function checkTranslation(id, original) {
        const inputEl = document.getElementById(`t-input-${id}`);
        const input = inputEl.value.trim();
        const resultDiv = document.getElementById(`t-result-${id}`);
        
        userTransInputs[id] = input;

        const dmp = new diff_match_patch();
        const diffs = dmp.diff_main(input, original);
        dmp.diff_cleanupSemantic(diffs);
        
        let html = '';
        diffs.forEach(part => {
            if (part[0] === 0) html += `<span>${part[1]}</span>`;
            else if (part[0] === -1) html += `<span class="diff-del">${part[1]}</span>`;
            else html += `<span class="diff-ins">${part[1]}</span>`;
        });

        resultDiv.innerHTML = `
            <div class="diff-result">
                <div style="margin-bottom:5px;"><strong>æ‰¹æ”¹ç»“æœï¼š</strong></div>
                <div>${html}</div>
                <div style="margin-top:10px; color:#666;"><strong>å‚è€ƒç­”æ¡ˆï¼š</strong> ${original}</div>
            </div>
        `;
        resultDiv.style.display = 'block';
    }

    function exportTransExcel() {
        if (!currentTrans) return;
        const data = currentTrans.pairs.map(p => ({
            "Chinese": p.cn,
            "My Translation": userTransInputs[p.id] || "(æœªå¡«å†™)",
            "Correct Answer": p.en
        }));
        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Translation Result");
        XLSX.writeFile(wb, `Translation_${currentTrans.title}.xlsx`);
    }
</script>

</body>
</html>